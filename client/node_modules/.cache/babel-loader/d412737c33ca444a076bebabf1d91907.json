{"ast":null,"code":"var _jsxFileName = \"/Users/mina/Desktop/Ganzi_Frontend/Frontend/client/src/pages/VideoRoom.jsx\",\n  _s = $RefreshSig$();\nimport React, { useEffect, useCallback, useState } from \"react\";\nimport ReactPlayer from 'react-player';\nimport { useSocket } from \"../providers/Socket\";\nimport { usePeer } from \"../providers/Peer\";\nimport '../pages/VideoRoom.css';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst VideoRoomPage = () => {\n  _s();\n  const {\n    socket\n  } = useSocket();\n  const {\n    peer,\n    createOffer,\n    createAnswer,\n    setRemoteAns,\n    sendStream,\n    remoteStream,\n    handleTrackEvent\n  } = usePeer();\n  const [myStream, setMyStream] = useState(null);\n  // const [remoteStream, setRemoteStream] = useState(null);\n  const [remoteEmailId, setRemoteEmaildId] = useState();\n  const handleNewUserJoined = useCallback(async data => {\n    const {\n      emailId\n    } = data;\n    console.log(\"New user joined the room\", emailId);\n    const offer = await createOffer();\n    socket.emit(\"call-user\", {\n      emailId,\n      offer\n    });\n    setRemoteEmaildId(emailId);\n  }, [createOffer, socket]);\n  const handleIncommingCall = useCallback(async data => {\n    const {\n      from,\n      offer\n    } = data;\n    console.log(\"Incomming Call From\", from, offer);\n    const ans = await createAnswer(offer);\n    socket.emit('call-accept', {\n      emailId: from,\n      ans\n    });\n    setRemoteEmaildId(from);\n  }, [createAnswer, socket]);\n  const handleCallAccepted = useCallback(async data => {\n    const {\n      ans\n    } = data;\n    console.log('Call Got Accepted', ans);\n    await setRemoteAns(ans);\n    // sendStream(myStream);\n  }, [setRemoteAns]);\n  const getUserMediaStream = useCallback(async () => {\n    const stream = await navigator.mediaDevices.getUserMedia({\n      audio: true,\n      video: true\n    });\n    // sendStream(stream);\n    setMyStream(stream);\n  }, []);\n  const handleNegosiation = useCallback(() => {\n    const localOffer = peer.localDescription;\n    socket.emit('call-user', {\n      emailId: remoteEmailId,\n      offer: localOffer\n    });\n  }, [peer.localDescription, remoteEmailId, socket]);\n  useEffect(() => {\n    socket.on(\"user-joined\", handleNewUserJoined);\n    socket.on(\"incomming-call\", handleIncommingCall);\n    socket.on(\"call-accepted\", handleCallAccepted);\n    return () => {\n      socket.off(\"user-joined\", handleNewUserJoined);\n      socket.off(\"incomming-call\", handleIncommingCall);\n      socket.off(\"call-accepted\", handleIncommingCall);\n    };\n  }, [handleIncommingCall, handleIncommingCall, handleNewUserJoined, socket]);\n  useEffect(() => {\n    peer.addEventListener(\"negotiationneeded\", handleNegosiation);\n    return () => {\n      peer.removeEventListener(\"negotiationneeded\", handleNegosiation);\n    };\n  }, [handleTrackEvent, peer]);\n  useEffect(() => {\n    getUserMediaStream();\n  }, [getUserMediaStream]);\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"videoroom-page-container\",\n    children: [/*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"header-bar\",\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"logo-container\",\n        children: /*#__PURE__*/_jsxDEV(\"img\", {\n          src: \"/images/Ganzi1.png\",\n          alt: \"\\uB85C\\uACE0\\uC774\\uBBF8\\uC9C0\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 81,\n          columnNumber: 16\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 80,\n        columnNumber: 13\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"meeting-title\",\n        children: \"\\uC878\\uD504 \\uD68C\\uC758\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 83,\n        columnNumber: 13\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"user-name\",\n        children: \"User Name\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 84,\n        columnNumber: 13\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 79,\n      columnNumber: 9\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"video-stream\",\n      children: [/*#__PURE__*/_jsxDEV(\"h4\", {\n        children: [remoteEmailId, \" \\uD568\\uAED8 \\uD68C\\uC758\\uC911 \"]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 90,\n        columnNumber: 13\n      }, this), /*#__PURE__*/_jsxDEV(ReactPlayer, {\n        url: myStream,\n        playing: true,\n        muted: true\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 91,\n        columnNumber: 13\n      }, this), /*#__PURE__*/_jsxDEV(ReactPlayer, {\n        url: remoteStream,\n        playing: true\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 92,\n        columnNumber: 13\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 88,\n      columnNumber: 9\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"bottom-bar\",\n      children: /*#__PURE__*/_jsxDEV(\"button\", {\n        onClick: e => sendStream(myStream),\n        children: \"Video\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 97,\n        columnNumber: 13\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 96,\n      columnNumber: 9\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 77,\n    columnNumber: 5\n  }, this);\n};\n_s(VideoRoomPage, \"9cjKGDY5LMYfj7HtAT2IW9EqV6Y=\", false, function () {\n  return [useSocket, usePeer];\n});\n_c = VideoRoomPage;\nexport default VideoRoomPage;\nvar _c;\n$RefreshReg$(_c, \"VideoRoomPage\");","map":{"version":3,"names":["React","useEffect","useCallback","useState","ReactPlayer","useSocket","usePeer","jsxDEV","_jsxDEV","VideoRoomPage","_s","socket","peer","createOffer","createAnswer","setRemoteAns","sendStream","remoteStream","handleTrackEvent","myStream","setMyStream","remoteEmailId","setRemoteEmaildId","handleNewUserJoined","data","emailId","console","log","offer","emit","handleIncommingCall","from","ans","handleCallAccepted","getUserMediaStream","stream","navigator","mediaDevices","getUserMedia","audio","video","handleNegosiation","localOffer","localDescription","on","off","addEventListener","removeEventListener","className","children","src","alt","fileName","_jsxFileName","lineNumber","columnNumber","url","playing","muted","onClick","e","_c","$RefreshReg$"],"sources":["/Users/mina/Desktop/Ganzi_Frontend/Frontend/client/src/pages/VideoRoom.jsx"],"sourcesContent":["import React, { useEffect, useCallback, useState } from \"react\";\nimport ReactPlayer from 'react-player';\nimport { useSocket } from \"../providers/Socket\";\nimport { usePeer } from \"../providers/Peer\";\nimport '../pages/VideoRoom.css';\n\nconst VideoRoomPage = () => {\n    const { socket } = useSocket();\n    const { peer, createOffer, createAnswer, setRemoteAns, sendStream, remoteStream, handleTrackEvent } = usePeer();\n    \n    const [myStream, setMyStream] = useState(null);\n    // const [remoteStream, setRemoteStream] = useState(null);\n    const [remoteEmailId, setRemoteEmaildId] = useState();\n\n    const handleNewUserJoined = useCallback(async (data) => {\n        const {emailId} = data;\n        console.log(\"New user joined the room\", emailId);\n        const offer = await createOffer();\n        socket.emit(\"call-user\", { emailId, offer });\n        setRemoteEmaildId(emailId)\n    }, [createOffer, socket]);\n\n    const handleIncommingCall = useCallback(async (data) => {\n        const { from, offer } = data;\n        console.log(\"Incomming Call From\", from, offer);\n        const ans = await createAnswer(offer);\n        socket.emit('call-accept', { emailId: from, ans });\n        setRemoteEmaildId(from)\n    }, [createAnswer, socket]);\n\n    const handleCallAccepted = useCallback(\n        async (data) => {\n        const { ans } = data;\n        console.log('Call Got Accepted', ans);\n        await setRemoteAns(ans);\n        // sendStream(myStream);\n    }, [setRemoteAns]\n    );\n\n    const getUserMediaStream = useCallback(async() => {\n        const stream = await navigator.mediaDevices.getUserMedia({ audio: true, video: true });\n        // sendStream(stream);\n        setMyStream(stream);\n    }, [])\n\n    const handleNegosiation = useCallback(() =>\n    {\n        const localOffer = peer.localDescription;\n        socket.emit('call-user', { emailId: remoteEmailId, offer: localOffer });\n    },[peer.localDescription, remoteEmailId, socket])\n\n    useEffect(() => {\n        socket.on(\"user-joined\", handleNewUserJoined);\n        socket.on(\"incomming-call\", handleIncommingCall);\n        socket.on(\"call-accepted\", handleCallAccepted);\n\n        return () => {\n            socket.off(\"user-joined\", handleNewUserJoined);\n            socket.off(\"incomming-call\", handleIncommingCall);\n            socket.off(\"call-accepted\", handleIncommingCall);\n        }\n\n    }, [handleIncommingCall, handleIncommingCall, handleNewUserJoined, socket]);\n\n    useEffect(() => {\n        peer.addEventListener(\"negotiationneeded\",handleNegosiation);\n        return () => {\n            peer.removeEventListener(\"negotiationneeded\", handleNegosiation);\n        };\n    }, [handleTrackEvent, peer]);\n\n    useEffect(() => {\n        getUserMediaStream();\n    }, [getUserMediaStream])\n\n    return(\n    <div className='videoroom-page-container'>\n        {/* 헤더 바 */}\n        <div className=\"header-bar\">\n            <div className='logo-container'>\n               <img src=\"/images/Ganzi1.png\" alt=\"로고이미지\"/>\n            </div>\n            <div className=\"meeting-title\">졸프 회의</div>\n            <div className=\"user-name\">User Name</div>\n        </div>\n\n        {/* 비디오 스트림 화면 */}\n        <div className=\"video-stream\">\n            {/* <h1>VideoRoom Page</h1> */}\n            <h4>{remoteEmailId} 함께 회의중 </h4>\n            <ReactPlayer url={myStream} playing muted />\n            <ReactPlayer url={remoteStream} playing />\n        </div>\n\n        {/* 하단 바 */}\n        <div className=\"bottom-bar\">\n            <button onClick={(e) => sendStream(myStream)}>Video</button>\n        </div>\n    \n        {/* <h1>VideoRoom Page</h1>\n        <h4>Your are connected to {remoteEmailId}</h4>\n        <button onClick={(e) => sendStream(myStream)}>Video</button>\n        <ReactPlayer url={myStream} playing muted />\n        <ReactPlayer url={remoteStream} playing /> */}\n    </div>\n    );\n};\n\nexport default VideoRoomPage;"],"mappings":";;AAAA,OAAOA,KAAK,IAAIC,SAAS,EAAEC,WAAW,EAAEC,QAAQ,QAAQ,OAAO;AAC/D,OAAOC,WAAW,MAAM,cAAc;AACtC,SAASC,SAAS,QAAQ,qBAAqB;AAC/C,SAASC,OAAO,QAAQ,mBAAmB;AAC3C,OAAO,wBAAwB;AAAC,SAAAC,MAAA,IAAAC,OAAA;AAEhC,MAAMC,aAAa,GAAGA,CAAA,KAAM;EAAAC,EAAA;EACxB,MAAM;IAAEC;EAAO,CAAC,GAAGN,SAAS,CAAC,CAAC;EAC9B,MAAM;IAAEO,IAAI;IAAEC,WAAW;IAAEC,YAAY;IAAEC,YAAY;IAAEC,UAAU;IAAEC,YAAY;IAAEC;EAAiB,CAAC,GAAGZ,OAAO,CAAC,CAAC;EAE/G,MAAM,CAACa,QAAQ,EAAEC,WAAW,CAAC,GAAGjB,QAAQ,CAAC,IAAI,CAAC;EAC9C;EACA,MAAM,CAACkB,aAAa,EAAEC,iBAAiB,CAAC,GAAGnB,QAAQ,CAAC,CAAC;EAErD,MAAMoB,mBAAmB,GAAGrB,WAAW,CAAC,MAAOsB,IAAI,IAAK;IACpD,MAAM;MAACC;IAAO,CAAC,GAAGD,IAAI;IACtBE,OAAO,CAACC,GAAG,CAAC,0BAA0B,EAAEF,OAAO,CAAC;IAChD,MAAMG,KAAK,GAAG,MAAMf,WAAW,CAAC,CAAC;IACjCF,MAAM,CAACkB,IAAI,CAAC,WAAW,EAAE;MAAEJ,OAAO;MAAEG;IAAM,CAAC,CAAC;IAC5CN,iBAAiB,CAACG,OAAO,CAAC;EAC9B,CAAC,EAAE,CAACZ,WAAW,EAAEF,MAAM,CAAC,CAAC;EAEzB,MAAMmB,mBAAmB,GAAG5B,WAAW,CAAC,MAAOsB,IAAI,IAAK;IACpD,MAAM;MAAEO,IAAI;MAAEH;IAAM,CAAC,GAAGJ,IAAI;IAC5BE,OAAO,CAACC,GAAG,CAAC,qBAAqB,EAAEI,IAAI,EAAEH,KAAK,CAAC;IAC/C,MAAMI,GAAG,GAAG,MAAMlB,YAAY,CAACc,KAAK,CAAC;IACrCjB,MAAM,CAACkB,IAAI,CAAC,aAAa,EAAE;MAAEJ,OAAO,EAAEM,IAAI;MAAEC;IAAI,CAAC,CAAC;IAClDV,iBAAiB,CAACS,IAAI,CAAC;EAC3B,CAAC,EAAE,CAACjB,YAAY,EAAEH,MAAM,CAAC,CAAC;EAE1B,MAAMsB,kBAAkB,GAAG/B,WAAW,CAClC,MAAOsB,IAAI,IAAK;IAChB,MAAM;MAAEQ;IAAI,CAAC,GAAGR,IAAI;IACpBE,OAAO,CAACC,GAAG,CAAC,mBAAmB,EAAEK,GAAG,CAAC;IACrC,MAAMjB,YAAY,CAACiB,GAAG,CAAC;IACvB;EACJ,CAAC,EAAE,CAACjB,YAAY,CAChB,CAAC;EAED,MAAMmB,kBAAkB,GAAGhC,WAAW,CAAC,YAAW;IAC9C,MAAMiC,MAAM,GAAG,MAAMC,SAAS,CAACC,YAAY,CAACC,YAAY,CAAC;MAAEC,KAAK,EAAE,IAAI;MAAEC,KAAK,EAAE;IAAK,CAAC,CAAC;IACtF;IACApB,WAAW,CAACe,MAAM,CAAC;EACvB,CAAC,EAAE,EAAE,CAAC;EAEN,MAAMM,iBAAiB,GAAGvC,WAAW,CAAC,MACtC;IACI,MAAMwC,UAAU,GAAG9B,IAAI,CAAC+B,gBAAgB;IACxChC,MAAM,CAACkB,IAAI,CAAC,WAAW,EAAE;MAAEJ,OAAO,EAAEJ,aAAa;MAAEO,KAAK,EAAEc;IAAW,CAAC,CAAC;EAC3E,CAAC,EAAC,CAAC9B,IAAI,CAAC+B,gBAAgB,EAAEtB,aAAa,EAAEV,MAAM,CAAC,CAAC;EAEjDV,SAAS,CAAC,MAAM;IACZU,MAAM,CAACiC,EAAE,CAAC,aAAa,EAAErB,mBAAmB,CAAC;IAC7CZ,MAAM,CAACiC,EAAE,CAAC,gBAAgB,EAAEd,mBAAmB,CAAC;IAChDnB,MAAM,CAACiC,EAAE,CAAC,eAAe,EAAEX,kBAAkB,CAAC;IAE9C,OAAO,MAAM;MACTtB,MAAM,CAACkC,GAAG,CAAC,aAAa,EAAEtB,mBAAmB,CAAC;MAC9CZ,MAAM,CAACkC,GAAG,CAAC,gBAAgB,EAAEf,mBAAmB,CAAC;MACjDnB,MAAM,CAACkC,GAAG,CAAC,eAAe,EAAEf,mBAAmB,CAAC;IACpD,CAAC;EAEL,CAAC,EAAE,CAACA,mBAAmB,EAAEA,mBAAmB,EAAEP,mBAAmB,EAAEZ,MAAM,CAAC,CAAC;EAE3EV,SAAS,CAAC,MAAM;IACZW,IAAI,CAACkC,gBAAgB,CAAC,mBAAmB,EAACL,iBAAiB,CAAC;IAC5D,OAAO,MAAM;MACT7B,IAAI,CAACmC,mBAAmB,CAAC,mBAAmB,EAAEN,iBAAiB,CAAC;IACpE,CAAC;EACL,CAAC,EAAE,CAACvB,gBAAgB,EAAEN,IAAI,CAAC,CAAC;EAE5BX,SAAS,CAAC,MAAM;IACZiC,kBAAkB,CAAC,CAAC;EACxB,CAAC,EAAE,CAACA,kBAAkB,CAAC,CAAC;EAExB,oBACA1B,OAAA;IAAKwC,SAAS,EAAC,0BAA0B;IAAAC,QAAA,gBAErCzC,OAAA;MAAKwC,SAAS,EAAC,YAAY;MAAAC,QAAA,gBACvBzC,OAAA;QAAKwC,SAAS,EAAC,gBAAgB;QAAAC,QAAA,eAC5BzC,OAAA;UAAK0C,GAAG,EAAC,oBAAoB;UAACC,GAAG,EAAC;QAAO;UAAAC,QAAA,EAAAC,YAAA;UAAAC,UAAA;UAAAC,YAAA;QAAA,OAAC;MAAC;QAAAH,QAAA,EAAAC,YAAA;QAAAC,UAAA;QAAAC,YAAA;MAAA,OACzC,CAAC,eACN/C,OAAA;QAAKwC,SAAS,EAAC,eAAe;QAAAC,QAAA,EAAC;MAAK;QAAAG,QAAA,EAAAC,YAAA;QAAAC,UAAA;QAAAC,YAAA;MAAA,OAAK,CAAC,eAC1C/C,OAAA;QAAKwC,SAAS,EAAC,WAAW;QAAAC,QAAA,EAAC;MAAS;QAAAG,QAAA,EAAAC,YAAA;QAAAC,UAAA;QAAAC,YAAA;MAAA,OAAK,CAAC;IAAA;MAAAH,QAAA,EAAAC,YAAA;MAAAC,UAAA;MAAAC,YAAA;IAAA,OACzC,CAAC,eAGN/C,OAAA;MAAKwC,SAAS,EAAC,cAAc;MAAAC,QAAA,gBAEzBzC,OAAA;QAAAyC,QAAA,GAAK5B,aAAa,EAAC,mCAAQ;MAAA;QAAA+B,QAAA,EAAAC,YAAA;QAAAC,UAAA;QAAAC,YAAA;MAAA,OAAI,CAAC,eAChC/C,OAAA,CAACJ,WAAW;QAACoD,GAAG,EAAErC,QAAS;QAACsC,OAAO;QAACC,KAAK;MAAA;QAAAN,QAAA,EAAAC,YAAA;QAAAC,UAAA;QAAAC,YAAA;MAAA,OAAE,CAAC,eAC5C/C,OAAA,CAACJ,WAAW;QAACoD,GAAG,EAAEvC,YAAa;QAACwC,OAAO;MAAA;QAAAL,QAAA,EAAAC,YAAA;QAAAC,UAAA;QAAAC,YAAA;MAAA,OAAE,CAAC;IAAA;MAAAH,QAAA,EAAAC,YAAA;MAAAC,UAAA;MAAAC,YAAA;IAAA,OACzC,CAAC,eAGN/C,OAAA;MAAKwC,SAAS,EAAC,YAAY;MAAAC,QAAA,eACvBzC,OAAA;QAAQmD,OAAO,EAAGC,CAAC,IAAK5C,UAAU,CAACG,QAAQ,CAAE;QAAA8B,QAAA,EAAC;MAAK;QAAAG,QAAA,EAAAC,YAAA;QAAAC,UAAA;QAAAC,YAAA;MAAA,OAAQ;IAAC;MAAAH,QAAA,EAAAC,YAAA;MAAAC,UAAA;MAAAC,YAAA;IAAA,OAC3D,CAAC;EAAA;IAAAH,QAAA,EAAAC,YAAA;IAAAC,UAAA;IAAAC,YAAA;EAAA,OAOL,CAAC;AAEV,CAAC;AAAC7C,EAAA,CApGID,aAAa;EAAA,QACIJ,SAAS,EAC0EC,OAAO;AAAA;AAAAuD,EAAA,GAF3GpD,aAAa;AAsGnB,eAAeA,aAAa;AAAC,IAAAoD,EAAA;AAAAC,YAAA,CAAAD,EAAA"},"metadata":{},"sourceType":"module"}