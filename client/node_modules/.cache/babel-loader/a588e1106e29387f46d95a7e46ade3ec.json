{"ast":null,"code":"var _jsxFileName = \"/Users/mina/Desktop/Ganzi_Frontend/Frontend/client/src/providers/Peer.jsx\",\n  _s = $RefreshSig$(),\n  _s2 = $RefreshSig$();\nimport React, { useMemo, useEffect, useState, useCallback } from \"react\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst PeerContext = /*#__PURE__*/React.createContext(null);\nexport const usePeer = () => {\n  _s();\n  return React.useContext(PeerContext);\n};\n_s(usePeer, \"gDsCjeeItUuvgOWf1v4qoK9RF6k=\");\nexport const PeerProvider = props => {\n  _s2();\n  const [remoteStream, setRemoteStream] = useState(null);\n  const peer = useMemo(() => new RTCPeerConnection({\n    iceServers: [{\n      /* STUN 서버 사용하여 WebRTC Peer Connection 매끄롭도록 */\n      urls: [\"stun:stun.l.google.com:19302\", \"stun:global.stun.twilio.com:3478\"]\n    }]\n  }), []);\n  const createOffer = async () => {\n    const offer = await peer.createOffer();\n    await peer.setLocalDescription(offer);\n    return offer;\n  };\n  const createAnswer = async offer => {\n    await peer.setRemoteDescription(offer);\n    const answer = await peer.createAnswer();\n    await peer.setLocalDescription(answer);\n    return answer;\n  };\n  const setRemoteAns = async ans => {\n    await peer.setRemoteDescription(ans);\n  };\n  const sendStream = async stream => {\n    const tracks = stream.getTracks();\n    // 이미 추가한 트랙을 추적하는 Set을 생성\n    const addedTracks = new Set();\n\n    // 이미 추가한 트랙을 확인하고 중복 추가 방지\n    for (const track of tracks) {\n      if (!addedTracks.has(track)) {\n        peer.addTrack(track, stream);\n        addedTracks.add(track);\n      }\n    }\n  };\n  const handleTrackEvent = useCallback(ev => {\n    const streams = ev.streams;\n    setRemoteStream(streams[0]);\n  }, []);\n\n  // const handleNegosiation = useCallback(() =>\n  // {\n  //     console.log(\"Neg Needed\");\n  // },[])\n\n  useEffect(() => {\n    peer.addEventListener(\"track\", handleTrackEvent);\n    // peer.addEventListener('negotiationneeded',handleNegosiation);\n    return () => {\n      // peer.removeEventListener('track', handleTrackEvent)\n    };\n  }, [handleTrackEvent, peer]);\n  return /*#__PURE__*/_jsxDEV(PeerContext.Provider, {\n    value: {\n      peer,\n      createOffer,\n      createAnswer,\n      setRemoteAns,\n      sendStream,\n      remoteStream\n    },\n    children: props.children\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 73,\n    columnNumber: 5\n  }, this);\n};\n_s2(PeerProvider, \"heVEnjVHvTruCYjECauIbeG2dC0=\");\n_c = PeerProvider;\nvar _c;\n$RefreshReg$(_c, \"PeerProvider\");","map":{"version":3,"names":["React","useMemo","useEffect","useState","useCallback","jsxDEV","_jsxDEV","PeerContext","createContext","usePeer","_s","useContext","PeerProvider","props","_s2","remoteStream","setRemoteStream","peer","RTCPeerConnection","iceServers","urls","createOffer","offer","setLocalDescription","createAnswer","setRemoteDescription","answer","setRemoteAns","ans","sendStream","stream","tracks","getTracks","addedTracks","Set","track","has","addTrack","add","handleTrackEvent","ev","streams","addEventListener","Provider","value","children","fileName","_jsxFileName","lineNumber","columnNumber","_c","$RefreshReg$"],"sources":["/Users/mina/Desktop/Ganzi_Frontend/Frontend/client/src/providers/Peer.jsx"],"sourcesContent":["import React, { useMemo, useEffect, useState, useCallback } from \"react\";\n\nconst PeerContext = React.createContext(null);\n\nexport const usePeer = () => React.useContext(PeerContext);\n\nexport const PeerProvider = (props) => {\n    const [remoteStream, setRemoteStream] = useState(null);\n    const peer = useMemo(() => new RTCPeerConnection({\n        iceServers : [\n            {\n                /* STUN 서버 사용하여 WebRTC Peer Connection 매끄롭도록 */\n                urls: [\n                    \"stun:stun.l.google.com:19302\",\n                    \"stun:global.stun.twilio.com:3478\"\n                ],\n            },\n        ],    \n     }), \n    []\n); \n\n    const createOffer = async () => {\n        const offer = await peer.createOffer();\n        await peer.setLocalDescription(offer);\n        return offer;\n    };\n\n    const createAnswer = async (offer) => {\n        await peer.setRemoteDescription(offer);\n        const answer = await peer.createAnswer();\n        await peer.setLocalDescription(answer);\n        return answer;\n    };\n\n    const setRemoteAns = async (ans) => {\n        await peer.setRemoteDescription(ans);\n    };\n\n    const sendStream = async (stream) => {\n        const tracks = stream.getTracks();\n        // 이미 추가한 트랙을 추적하는 Set을 생성\n        const addedTracks = new Set();\n    \n        // 이미 추가한 트랙을 확인하고 중복 추가 방지\n        for (const track of tracks) {\n            if (!addedTracks.has(track)) {\n                peer.addTrack(track, stream);\n                addedTracks.add(track);\n            }\n        }\n    };\n\n    const handleTrackEvent = useCallback((ev) => {\n        const streams = ev.streams;\n        setRemoteStream(streams[0])\n    },[]);\n\n    // const handleNegosiation = useCallback(() =>\n    // {\n    //     console.log(\"Neg Needed\");\n    // },[])\n\n    useEffect(() => {\n        peer.addEventListener(\"track\", handleTrackEvent);\n        // peer.addEventListener('negotiationneeded',handleNegosiation);\n        return () => {\n            // peer.removeEventListener('track', handleTrackEvent)\n        };\n    },[handleTrackEvent, peer]);\n\n    return (\n    <PeerContext.Provider value = {{ peer, createOffer, createAnswer, setRemoteAns, sendStream, remoteStream, }}>\n        {props.children}\n    </PeerContext.Provider>\n    );  \n};"],"mappings":"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"},"metadata":{},"sourceType":"module"}